<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbre G√©n√©alogique - Ta'a Fieu Tagni Tinang Joseph</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header h1 { color: #2c5f4f; font-size: 2.5em; margin-bottom: 10px; }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #4a7c6b 0%, #2c5f4f 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-number { font-size: 2.5em; font-weight: bold; }
        .stat-label { font-size: 1em; opacity: 0.9; margin-top: 5px; }
        .tabs-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1em;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover { color: #2c5f4f; background: #f0f8f5; }
        .tab.active { color: #2c5f4f; border-bottom-color: #4a7c6b; font-weight: 600; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tree-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        .generation-row {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin-bottom: 60px;
            position: relative;
        }
        .generation-row::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 2px;
            background: #ccc;
        }
        .generation-row:last-child::after { display: none; }
        .generation-label {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-weight: bold;
            color: #2c5f4f;
            margin-right: 20px;
            padding: 10px;
            background: #e8f4f0;
            border-radius: 8px;
        }
        .members-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            flex: 1;
        }
        .person-box {
            padding: 15px 20px;
            border-radius: 8px;
            min-width: 180px;
            max-width: 220px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
            position: relative;
        }
        .person-box:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .person-name { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
        .person-dates { font-size: 0.9em; opacity: 0.8; }
        .person-role { font-size: 0.85em; margin-top: 5px; font-style: italic; }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            background: none;
            border: none;
        }
        .modal-close:hover { color: #000; }
        .person-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .person-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4a7c6b;
            cursor: pointer;
            transition: all 0.3s;
        }
        .person-item:hover { background: #e9ecef; transform: translateX(5px); }
        .person-item h4 { color: #2c5f4f; margin-bottom: 5px; }
        .person-item p { font-size: 0.9em; color: #666; }
        .locations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .location-card {
            background: linear-gradient(135deg, #f0f8f5 0%, #e8f4f0 100%);
            border-left: 5px solid #4a7c6b;
            border-radius: 10px;
            padding: 20px;
        }
        .location-card h3 { color: #2c5f4f; margin-bottom: 10px; }
        .timeline { position: relative; padding: 20px 0; }
        .timeline-item { display: flex; margin-bottom: 30px; position: relative; }
        .timeline-date {
            min-width: 120px;
            font-weight: bold;
            color: #4a7c6b;
            padding-right: 20px;
        }
        .timeline-content {
            flex: 1;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid #4a7c6b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .timeline-content h4 { color: #2c5f4f; margin-bottom: 8px; }
        .timeline-content p { color: #666; line-height: 1.6; }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .generation-label { writing-mode: horizontal-tb; margin-right: 0; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå≥ Arbre G√©n√©alogique</h1>
        <p><strong>Ta'a Fieu Tagni Tinang Joseph</strong></p>
        <p style="font-size: 0.9em; color: #888; margin-top: 10px;">Syst√®me dynamique ‚Ä¢ G√©n√©rations calcul√©es automatiquement</p>
    </div>

    <div class="stats-container" id="statsContainer"></div>

    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview', this)">üìä Aper√ßu</button>
            <button class="tab" onclick="switchTab('royal', this)">üëë Lign√©es Royales</button>
            <button class="tab" onclick="switchTab('tree', this)">üå≥ Arbre</button>
            <button class="tab" onclick="switchTab('persons', this)">üë• Personnes</button>
            <button class="tab" onclick="switchTab('locations', this)">üìç Localit√©s</button>
            <button class="tab" onclick="switchTab('timeline', this)">üìÖ Dates Cl√©s</button>
        </div>

        <div id="overview" class="tab-content active">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">Vue d'ensemble</h2>
            <div id="overviewContent"></div>
        </div>

        <div id="royal" class="tab-content">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">üëë Lign√©es Royales</h2>
            <div style="background: linear-gradient(135deg, #fff8e1 0%, #ffe082 100%); padding: 30px; border-radius: 15px; margin-bottom: 30px; border: 3px solid #ffd54f;">
                <h3 style="color: #2c5f4f; margin-bottom: 15px; text-align: center;">Statut Royal</h3>
                <p style="text-align: center; font-size: 1.1em; line-height: 1.8;">
                    En tant que descendants des chefferies <strong>Baleng</strong>, <strong>Balengou</strong>, <strong>Batchingou</strong> et <strong>Bamena</strong>, 
                    les petits-fils et arri√®re-petits-fils de Magni Kouabou et de Tchi√© Ngantchi√© sont des <strong style="color: #d4a300;">princes et altesses royales</strong>.
                </p>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                <div style="background: white; padding: 25px; border-radius: 12px; border-left: 6px solid #8b4513; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #2c5f4f; margin-bottom: 15px;">1Ô∏è‚É£ CHEFFERIE BALENG</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">üë§ <strong>Connexion:</strong> Prince Nandjo (~1770s)</li>
                        <li style="margin: 10px 0;">üö∂ <strong>Migration:</strong> Baleng ‚Üí Balengou</li>
                    </ul>
                </div>
                <div style="background: white; padding: 25px; border-radius: 12px; border-left: 6px solid #4a7c6b; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #2c5f4f; margin-bottom: 15px;">2Ô∏è‚É£ CHEFFERIE BALENGOU</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">üë§ <strong>Connexion:</strong> Wetio Kouamou</li>
                        <li style="margin: 10px 0;">üéñÔ∏è <strong>Titre:</strong> "Ta'a fieu"</li>
                    </ul>
                </div>
                <div style="background: white; padding: 25px; border-radius: 12px; border-left: 6px solid #2196f3; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #2c5f4f; margin-bottom: 15px;">3Ô∏è‚É£ CHEFFERIE BATCHINGOU</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">üë§ <strong>Connexion:</strong> Tchi√© Ngantchi√©</li>
                        <li style="margin: 10px 0;">‚öîÔ∏è <strong>Fonction:</strong> Ministre D√©fense</li>
                    </ul>
                </div>
                <div style="background: white; padding: 25px; border-radius: 12px; border-left: 6px solid #9c27b0; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                    <h4 style="color: #2c5f4f; margin-bottom: 15px;">4Ô∏è‚É£ CHEFFERIE BAMENA</h4>
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 10px 0;">üë§ <strong>Connexion:</strong> Ta'a Nanwou</li>
                        <li style="margin: 10px 0;">üëë <strong>Lign√©e:</strong> Megni Ngongang Rebecca</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="tree" class="tab-content">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">Arbre (g√©n√©rations automatiques)</h2>
            <div id="familyTree" class="tree-container">
                <p style="text-align: center; color: #666;">Chargement...</p>
            </div>
        </div>

        <div id="persons" class="tab-content">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">Tous les membres</h2>
            <div id="personsList" class="person-list"></div>
        </div>

        <div id="locations" class="tab-content">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">Localit√©s familiales</h2>
            <div id="locationsGrid" class="locations-grid"></div>
        </div>

        <div id="timeline" class="tab-content">
            <h2 style="color: #2c5f4f; margin-bottom: 20px;">Chronologie</h2>
            <div id="timelineContent" class="timeline"></div>
        </div>
    </div>

    <div class="modal" id="personModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        let familyData = { persons: [], locations: [] };
        let generationsMap = new Map();

        async function loadData() {
            try {
                const response = await fetch('family-data-dynamic.json');
                familyData = await response.json();
                calculateGenerations();
                renderStats();
                renderOverview();
                renderTree();
                renderPersonsList();
                renderLocations();
                renderTimeline();
            } catch (error) {
                console.error('Erreur:', error);
            }
        }

        function calculateGenerations() {
            generationsMap.clear();
            const roots = familyData.persons.filter(p => !p.parentId);
            roots.forEach(p => generationsMap.set(p.id, 1));
            let changed = true, iter = 0;
            while (changed && iter++ < 20) {
                changed = false;
                familyData.persons.forEach(p => {
                    if (!generationsMap.has(p.id) && p.parentId) {
                        const parentGen = generationsMap.get(p.parentId);
                        if (parentGen !== undefined) {
                            generationsMap.set(p.id, parentGen + 1);
                            changed = true;
                        }
                    }
                });
            }
        }

        function getGeneration(id) { return generationsMap.get(id) || 1; }

        function getGenerationColor(n) {
            const c = [
                { bg: 'linear-gradient(135deg, #a8d5ba 0%, #88c0a5 100%)', border: '#6fa585' },
                { bg: 'linear-gradient(135deg, #d4d4d4 0%, #b8b8b8 100%)', border: '#999' },
                { bg: 'linear-gradient(135deg, #333 0%, #1a1a1a 100%)', border: '#000', color: 'white' },
                { bg: 'linear-gradient(135deg, #f4e04d 0%, #e8d73a 100%)', border: '#d4c230' },
                { bg: 'linear-gradient(135deg, #a8d5ba 0%, #88c0a5 100%)', border: '#6fa585' },
                { bg: 'linear-gradient(135deg, #87ceeb 0%, #6db9d6 100%)', border: '#5a9fc0' },
                { bg: 'linear-gradient(135deg, #4682b4 0%, #36648b 100%)', border: '#2c5474', color: 'white' }
            ];
            return c[(n - 1) % c.length];
        }

        function renderStats() {
            const maxGen = Math.max(...Array.from(generationsMap.values()));
            document.getElementById('statsContainer').innerHTML = `
                <div class="stat-card"><div class="stat-number">${familyData.persons.length}</div><div class="stat-label">Membres</div></div>
                <div class="stat-card"><div class="stat-number">${maxGen}</div><div class="stat-label">G√©n√©rations (auto)</div></div>
                <div class="stat-card"><div class="stat-number">${familyData.locations.length}</div><div class="stat-label">Localit√©s</div></div>
            `;
        }

        function renderOverview() {
            const p = familyData.persons.find(x => x.role === 'Patriarche');
            const h = familyData.persons.find(x => x.role === 'H√©ritier');
            document.getElementById('overviewContent').innerHTML = `
                <div style="background: linear-gradient(135deg, #f0f8f5 0%, #e8f4f0 100%); padding: 30px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #2c5f4f;">üëë Le Patriarche</h3>
                    <h4 style="color: #4a7c6b;">${p.name}</h4>
                    <p><strong>${p.dates}</strong> (${p.lifespan})</p>
                </div>
                <div style="background: linear-gradient(135deg, #fff8e1 0%, #fff3cd 100%); padding: 30px; border-radius: 10px;">
                    <h3 style="color: #2c5f4f;">‚≠ê L'H√©ritier</h3>
                    <h4 style="color: #4a7c6b;">${h.name}</h4>
                    <p><strong>N√©:</strong> ${h.born}</p>
                </div>
            `;
        }

        function renderTree() {
            const maxGen = Math.max(...Array.from(generationsMap.values()));
            let html = '';
            for (let g = 1; g <= maxGen; g++) {
                const ps = familyData.persons.filter(p => getGeneration(p.id) === g);
                if (ps.length === 0) continue;
                html += `<div class="generation-row">
                    <div class="generation-label">G√©n√©ration ${g}<br><span style="font-size:0.8em;">(${ps.length})</span></div>
                    <div class="members-container">`;
                ps.forEach(p => html += createPersonBox(p, g));
                html += `</div></div>`;
            }
            document.getElementById('familyTree').innerHTML = html;
        }

        function createPersonBox(p, g) {
            const c = getGenerationColor(g);
            const dates = p.dates || (p.born ? `n√© ${p.born}` : '');
            const role = p.role ? `<div class="person-role">${p.role}</div>` : '';
            return `
                <div class="person-box" style="background: ${c.bg}; border-color: ${c.border}; ${c.color ? `color: ${c.color};` : ''}" onclick="showPersonDetails('${p.id}')">
                    <div class="person-name">${p.name}</div>
                    ${dates ? `<div class="person-dates">${dates}</div>` : ''}
                    ${role}
                </div>
            `;
        }

        function showPersonDetails(id) {
            const p = familyData.persons.find(x => x.id === id);
            const parent = p.parentId ? familyData.persons.find(x => x.id === p.parentId) : null;
            const children = familyData.persons.filter(x => x.parentId === p.id);
            document.getElementById('modalBody').innerHTML = `
                <h2 style="color: #2c5f4f;">${p.name}</h2>
                ${p.ndap ? `<p><em>Ndap: ${p.ndap}</em></p>` : ''}
                ${p.dates || p.born ? `<p><strong>üìÖ:</strong> ${p.dates || 'N√© ' + p.born}</p>` : ''}
                <p><strong>üß¨ G√©n√©ration:</strong> ${getGeneration(id)}</p>
                ${p.birthPlace ? `<p><strong>üìç Naissance:</strong> ${p.birthPlace}</p>` : ''}
                ${p.residence ? `<p><strong>üè† R√©sidence:</strong> ${p.residence}</p>` : ''}
                ${parent ? `<p><strong>‚¨ÜÔ∏è Parent:</strong> ${parent.name}</p>` : ''}
                ${children.length > 0 ? `<div><strong>‚¨áÔ∏è Enfants (${children.length}):</strong><ul style="margin-left:20px;">${children.map(c => `<li>${c.name}</li>`).join('')}</ul></div>` : ''}
                ${p.notes ? `<p><strong>üìù:</strong> ${p.notes}</p>` : ''}
            `;
            document.getElementById('personModal').classList.add('active');
        }

        function closeModal() { document.getElementById('personModal').classList.remove('active'); }

        function switchTab(tab, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            if (el) el.classList.add('active');
        }

        function renderPersonsList() {
            const sorted = [...familyData.persons].sort((a, b) => {
                const d = getGeneration(a.id) - getGeneration(b.id);
                return d !== 0 ? d : a.name.localeCompare(b.name);
            });
            document.getElementById('personsList').innerHTML = sorted.map(p => `
                <div class="person-item" onclick="showPersonDetails('${p.id}')">
                    <h4>${p.name}</h4>
                    <p>G√©n√©ration ${getGeneration(p.id)}</p>
                    ${p.residence ? `<p>üìç ${p.residence}</p>` : ''}
                </div>
            `).join('');
        }

        function renderLocations() {
            document.getElementById('locationsGrid').innerHTML = familyData.locations.map(l => `
                <div class="location-card">
                    <h3>üìç ${l.name}</h3>
                    <p style="color:#666;">${l.description}</p>
                </div>
            `).join('');
        }

        function renderTimeline() {
            const events = [
                { date: "~1770s", title: "Origines Royales", content: "Prince Nandjo, fondateur" },
                { date: "1898", title: "Naissance Patriarche", content: "Ta'a Fieu Tagni Tinang Joseph" },
                { date: "1906", title: "Mariage", content: "Union avec Rebecca" },
                { date: "1947-1968", title: "G√©n√©ration 6", content: "9 enfants" },
                { date: "1960", title: "Ind√©pendance", content: "Installation Foumbot" },
                { date: "2001", title: "Succession", content: "Emmanuel intronis√©" }
            ];
            document.getElementById('timelineContent').innerHTML = events.map(e => `
                <div class="timeline-item">
                    <div class="timeline-date">${e.date}</div>
                    <div class="timeline-content">
                        <h4>${e.title}</h4>
                        <p>${e.content}</p>
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', loadData);
        document.getElementById('personModal').addEventListener('click', e => { if (e.target === e.currentTarget) closeModal(); });
    </script>
</body>
</html>
